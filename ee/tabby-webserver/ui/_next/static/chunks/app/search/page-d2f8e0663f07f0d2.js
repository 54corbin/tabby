(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2797],{72845:function(e,t,n){Promise.resolve().then(n.bind(n,37148))},37148:function(e,t,n){"use strict";n.r(t),n.d(t,{SOURCE_CARD_STYLE:function(){return eN},Search:function(){return eI},SearchContext:function(){return ej}});var s=n(36164),l=n(3546),r=n(11978),a=n(56575),i=n(21808),o=n(93877),c=n(9010),d=n(16784),u=n(80605),h=n(1544),m=n(31458),x=n(81565),f=n(53538),v=n(57830),p=n(72657),g=n(68172),j=n(30601),N=n(24203),w=n(63743),b=n(52569),I=n(7449);n(2489);var S=n(70652),y=n.n(S),C=n(54767),k=n(1853),R=n(82030),E=n(72940),_=n(52807),M=n(51722),L=n(19108),z=n(2578),T=n(40055),A=n(43240),F=n(18500),O=n(28312),P=n(24449),U=n(98454),D=n(44645),Z=n(64566),G=n(37266),Q=n(11634),V=n(70410),H=n(11208),$=n(84381),X=n(62226),q=n.n(X),J=n(6797),W=n.n(J),K=n(94909),B=n(66686),Y=n(5493),ee=n(23455),et=n(23782),en=n(74038),es=n(55832),el=n(98150),er=n(3448),ea=n(29),ei=n(90168),eo=n(48537),ec=n(10279);function ed(e){var t,n,r,a;let{message:i,showRelatedQuestion:o,isLoading:c,isLastAssistantMessage:d,isDeletable:u,className:f}=e,{onRegenerateResponse:v,onSubmitSearch:p,setDevPanelOpen:g,setConversationIdForDev:j,enableDeveloperMode:N,contextInfo:w,fetchingContextInfo:b,onDeleteMessage:I,isThreadOwner:S,onUpdateMessage:y}=(0,l.useContext)(ej),[C,R]=(0,l.useState)(!1),[E,_]=(0,l.useState)(!1),[M,L]=(0,l.useState)(void 0),z=c?x.IconSpinner:x.IconSparkles,T=null==i?void 0:null===(t=i.attachment)||void 0===t?void 0:t.doc,A=null==i?void 0:null===(n=i.attachment)||void 0===n?void 0:n.code,F=(null==T?void 0:T.length)?Math.ceil(T.length/4)*eN.expand+.5*Math.floor(T.length/4)+.5:0,O=(0,l.useMemo)(()=>{var e,t,n;return null!==(n=null==i?void 0:null===(t=i.attachment)||void 0===t?void 0:null===(e=t.code)||void 0===e?void 0:e.map(e=>{var t;let{startLine:n,endLine:s}=(0,h.OV)(e);return{kind:"file",range:{start:n,end:s},filepath:e.filepath,content:e.content,git_url:e.gitUrl,extra:{scores:null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.scores}}}))&&void 0!==n?n:[]},[null==i?void 0:null===(r=i.attachment)||void 0===r?void 0:r.code]),P=e=>{let{startLine:t,endLine:n}=(0,h.OV)(e);if(!e.filepath)return;let s=new URL("".concat(window.location.origin,"/files")),l=new URLSearchParams;l.append("redirect_filepath",e.filepath),l.append("redirect_git_url",e.gitUrl),s.search=l.toString();let r=(0,h.nO)({start:t,end:n});r&&(s.hash=r),window.open(s.toString())},U=async e=>{let t=await y(e);if(t)return t;R(!1)};return(0,s.jsxs)("div",{className:(0,h.cn)("flex flex-col gap-y-5",f),children:[T&&T.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-x-2",children:[(0,s.jsx)(x.IconBlocks,{className:"relative",style:{top:"-0.04rem"}}),(0,s.jsx)("p",{className:"text-sm font-bold leading-normal",children:"Sources"})]}),(0,s.jsx)("div",{className:"gap-sm -mx-2 grid grid-cols-3 gap-2 overflow-y-hidden px-2 pt-2 md:grid-cols-4",style:{transition:"height 0.25s ease-out",height:E?"".concat(F,"rem"):"".concat(eN.compress+.5,"rem")},children:T.map((e,t)=>(0,s.jsx)(eu,{conversationId:i.id,source:e,showMore:E,showDevTooltip:N},e.link+t))}),(0,s.jsxs)(m.z,{variant:"ghost",className:"-ml-1.5 mt-1 flex items-center gap-x-1 px-1 py-2 text-sm font-normal text-muted-foreground",onClick:()=>_(!E),children:[(0,s.jsx)(x.IconChevronRight,{className:(0,h.cn)({"-rotate-90":E,"rotate-90":!E})}),(0,s.jsx)("p",{children:E?"Show less":"Show more"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-1 flex h-8 items-center gap-x-1.5",children:[(0,s.jsx)(z,{className:(0,h.cn)({"animate-spinner":c})}),(0,s.jsx)("p",{className:"text-sm font-bold leading-none",children:"Answer"}),N&&(0,s.jsx)(m.z,{variant:"ghost",size:"icon",onClick:()=>{j(i.id),g(!0)},children:(0,s.jsx)(x.IconBug,{})})]}),A&&A.length>0&&(0,s.jsx)(ei.q,{contexts:O,className:"mt-1 text-sm",onContextClick:e=>{if(!e.filepath)return;let t=new URL("".concat(window.location.origin,"/files")),n=new URLSearchParams;n.append("redirect_filepath",e.filepath),n.append("redirect_git_url",e.git_url),t.search=n.toString();let s=(0,h.nO)({start:e.range.start,end:e.range.end});s&&(t.hash=s),window.open(t.toString())},enableTooltip:N,showExternalLink:!1,onTooltipClick:()=>{j(i.id),g(!0)},highlightIndex:M}),c&&!i.content&&(0,s.jsx)(er.O,{className:"mt-1 h-40 w-full"}),C?(0,s.jsx)(eh,{message:i,onCancel:()=>R(!1),onSubmit:U}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ec.JG,{message:i.content,attachmentDocs:T,attachmentCode:A,onCodeCitationClick:e=>{P(e)},onCodeCitationMouseEnter:e=>{var t,n;L(e-1-((null==i?void 0:null===(n=i.attachment)||void 0===n?void 0:null===(t=n.doc)||void 0===t?void 0:t.length)||0))},onCodeCitationMouseLeave:e=>{L(void 0)},contextInfo:w,fetchingContextInfo:b,canWrapLongLines:!c}),i.error&&(0,s.jsx)(ec.mE,{error:i.error}),!c&&!C&&(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-3",children:S&&(0,s.jsxs)(s.Fragment,{children:[!c&&!b&&d&&(0,s.jsxs)(m.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>v(i.id),children:[(0,s.jsx)(x.IconRefresh,{}),(0,s.jsx)("p",{children:"Regenerate"})]}),u&&(0,s.jsxs)(m.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>I(i.id),children:[(0,s.jsx)(x.IconTrash,{}),(0,s.jsx)("p",{children:"Delete"})]})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,s.jsx)(eo.q,{className:"-ml-1.5 gap-x-1 px-1 font-normal text-muted-foreground",value:(e=>{var t,n,s,l,r,a,i,o,c,d,u;if((0,K.Z)(null==e?void 0:null===(t=e.attachment)||void 0===t?void 0:t.doc)&&(0,K.Z)(null==e?void 0:null===(n=e.attachment)||void 0===n?void 0:n.code))return e.content;let m=e.content.replace(en.H,e=>{let t=null==e?void 0:e.match(/\d+/);return"[".concat(t,"]")}).trim(),x=null!==(c=null===(l=e.attachment)||void 0===l?void 0:null===(s=l.doc)||void 0===s?void 0:s.map((e,t)=>"[".concat(t+1,"] ").concat(e.link)).join("\n"))&&void 0!==c?c:"",f=null!==(d=null===(a=e.attachment)||void 0===a?void 0:null===(r=a.doc)||void 0===r?void 0:r.length)&&void 0!==d?d:0,v=null!==(u=null===(o=e.attachment)||void 0===o?void 0:null===(i=o.code)||void 0===i?void 0:i.map((e,t)=>{let n=(0,h.tf)(e),s=(0,k.Z)([e.filepath,n]).join(":");return"[".concat(t+f+1,"] ").concat(s)}).join("\n"))&&void 0!==u?u:"";return"".concat(m,"\n\nCitations:\n").concat(x+v)})(i),text:"Copy"}),S&&(0,s.jsxs)(m.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:e=>R(!0),children:[(0,s.jsx)(x.IconEdit,{}),(0,s.jsx)("p",{children:"Edit"})]})]})]})]})]}),o&&!C&&!c&&i.threadRelevantQuestions&&i.threadRelevantQuestions.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,s.jsx)(x.IconLayers,{}),(0,s.jsx)("p",{className:"text-sm font-bold leading-none",children:"Suggestions"})]}),(0,s.jsx)("div",{className:"mt-2 flex flex-col gap-y-3",children:null===(a=i.threadRelevantQuestions)||void 0===a?void 0:a.map((e,t)=>(0,s.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-4 py-3 transition-opacity hover:opacity-70",onClick:p.bind(null,e),children:[(0,s.jsx)("p",{className:"w-full overflow-hidden text-ellipsis text-sm",children:e}),(0,s.jsx)(x.IconPlus,{})]},t))})]})]})}function eu(e){var t,n;let{conversationId:r,source:a,showMore:i,showDevTooltip:o,isDeletable:c,onDelete:d}=e,{setDevPanelOpen:u,setConversationIdForDev:f}=(0,l.useContext)(ej),{hostname:v}=new URL(a.link),[p,g]=(0,l.useState)(!1);return(0,s.jsxs)(ea.u,{open:p,onOpenChange:e=>{o&&g(e)},delayDuration:0,children:[(0,s.jsx)(ea.aJ,{asChild:!0,children:(0,s.jsxs)("div",{className:"relative flex cursor-pointer flex-col justify-between rounded-lg border bg-card p-3 hover:bg-card/60",style:{height:i?"".concat(eN.expand,"rem"):"".concat(eN.compress,"rem"),transition:"all 0.25s ease-out"},onClick:()=>window.open(a.link),children:[c&&(0,s.jsx)("div",{className:"absolute -right-1.5 -top-2",children:(0,s.jsx)(m.z,{size:"icon",variant:"secondary",className:"h-4 w-4 rounded-full border",onClick:e=>{e.stopPropagation(),null==d||d()},children:(0,s.jsx)(x.IconRemove,{className:"h-3 w-3"})})}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col justify-between gap-y-1",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsx)("p",{className:"line-clamp-1 w-full overflow-hidden text-ellipsis break-all text-xs font-semibold",children:a.title}),(0,s.jsx)("p",{className:(0,h.cn)(" w-full overflow-hidden text-ellipsis break-all text-xs text-muted-foreground",{"line-clamp-2":i,"line-clamp-1":!i}),children:em(a.content)})]}),(0,s.jsx)("div",{className:"flex items-center text-xs text-muted-foreground",children:(0,s.jsxs)("div",{className:"flex w-full flex-1 items-center",children:[(0,s.jsx)(ec.V$,{hostname:v}),(0,s.jsx)("p",{className:"ml-1 overflow-hidden text-ellipsis",children:v.replace("www.","").split("/")[0]})]})})]})]})}),(0,s.jsx)(ea._v,{align:"start",className:"cursor-pointer p-2",onClick:e=>{e.stopPropagation(),f(r),u(!0)},children:(0,s.jsxs)("p",{children:["Score: ",null!==(n=null==a?void 0:null===(t=a.extra)||void 0===t?void 0:t.score)&&void 0!==n?n:"-"]})})]})}function eh(e){let{message:t,onCancel:n,onSubmit:r}=e,a=et.Ry({content:et.Z_().trim()}),i=(0,Y.cI)({resolver:(0,$.F)(a),defaultValues:{content:t.content}}),{isSubmitting:o}=i.formState,{content:c}=i.watch(),d=!c||(0,K.Z)(c.trim()),[u]=(0,l.useState)(t),{formRef:h,onKeyDown:f}=(0,es.h)(),v=async e=>{let t=await r({...u,content:e.content});t&&i.setError("root",{message:t})};return(0,s.jsx)(el.l0,{...i,children:(0,s.jsxs)("form",{ref:h,onSubmit:i.handleSubmit(v),children:[(0,s.jsx)(el.Wi,{control:i.control,name:"content",render:e=>{let{field:t}=e;return(0,s.jsxs)(el.xJ,{children:[(0,s.jsx)(el.NI,{children:(0,s.jsx)(ee.Z,{autoFocus:!0,minRows:2,maxRows:20,className:"w-full rounded-lg border bg-background p-4 outline-ring",onKeyDown:f,...t})}),(0,s.jsx)(el.zG,{})]})}}),(0,s.jsxs)("div",{className:"my-4 flex items-center justify-between gap-2 px-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)(el.zG,{})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.z,{type:"button",variant:"outline",onClick:n,className:"min-w-[2rem]",children:"Cancel"}),(0,s.jsxs)(m.z,{type:"submit",disabled:d||o,children:[o&&(0,s.jsx)(x.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})]})})}let em=e=>{let t=q().sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),n=B.TU.parse(t),s=W().decode(n),l=s.replace(/<\/?[^>]+(>|$)/g,"");return l};var ex=n(90379);let ef=(0,l.lazy)(()=>n.e(726).then(n.t.bind(n,80726,23))),ev=e=>{let{value:t,isFullScreen:n,onToggleFullScreen:r,onClose:a}=e,[i]=(0,o.m)(),{theme:d}=(0,c.X)(),u=(0,l.useRef)(null);return((0,l.useEffect)(()=>{if(t){var e;null===(e=u.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})}},[t]),(null==i?void 0:i.value)&&open)?(0,s.jsxs)("div",{className:"flex h-full flex-col px-3 pt-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-end pb-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.z,{variant:"ghost",size:"icon",onClick:e=>r(!n),children:(0,s.jsx)(x.IconChevronDown,{className:(0,h.cn)("transition-all",n?"":"rotate-180")})}),(0,s.jsx)(m.z,{variant:"ghost",size:"icon",onClick:a,children:(0,s.jsx)(x.IconClose,{})})]})}),(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)(ex.cg,{className:"p-2"}),children:t?(0,s.jsx)(v.ScrollArea,{className:"flex-1",ref:u,children:(0,s.jsx)(ef,{theme:"dark"===d?"tomorrow":"rjv-default",src:t,style:{fontSize:"0.75rem"},collapseStringsAfterLength:120})}):null})]}):null};function ep(){return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(er.O,{className:"w-full"}),(0,s.jsx)(er.O,{className:"w-[70%]"})]}),(0,s.jsx)(er.O,{className:"h-40 w-full"})]})}function eg(e){let{message:t,className:n,...r}=e,{contextInfo:a,fetchingContextInfo:i}=(0,l.useContext)(ej);return(0,s.jsx)("div",{className:(0,h.cn)("font-semibold",n),...r,children:(0,s.jsx)(ec.JG,{message:t.content,contextInfo:a,fetchingContextInfo:i,className:"text-xl prose-p:mb-2 prose-p:mt-0",headline:!0,canWrapLongLines:!0})})}let ej=(0,l.createContext)({}),eN={compress:5.3,expand:6.3},ew="_temp_msg_",eb=()=>"".concat(ew).concat((0,a.x0)());function eI(){var e,t,n,a,g;let[{data:w}]=(0,U.P)(),{updateUrlComponents:b,pathname:I}=(0,D.Z)(),[S,y]=(0,l.useState)(),[_,A]=(0,l.useState)(!1),$=(0,u.xG)(),[X,q]=(0,l.useState)([]),[J,W]=(0,l.useState)(!0),[K,B]=(0,l.useState)(!1),[Y,ee]=(0,l.useState)(""),[et,en]=(0,l.useState)(""),es=(0,l.useRef)(null),[el,er]=(0,l.useState)(!1),[ea]=(0,j.Hb)(),ei=(0,r.useRouter)(),eo=(0,l.useRef)(!1),{theme:ec}=(0,c.X)(),[eu,eh]=(0,l.useState)(!1),[em,ex]=(0,l.useState)(),ef=(0,l.useRef)(null),[eN,eI]=(0,l.useState)(45),eE=(0,l.useRef)(eN),[e_]=(0,o.m)(),[eM,eL]=(0,l.useState)(),ez=(0,l.useMemo)(()=>{var e,t;if(S)return null===(t=S.match(/^\/search\/(.*)/))||void 0===t?void 0:null===(e=t[1])||void 0===e?void 0:e.split("-").pop()},[S]),eT=(0,Q.D)(ey),eA=async e=>{let t=X.findIndex(t=>t.id===e.id);if(!(t>-1)||!eM)return"Failed to save";{var n,s;let l=await eT({input:{threadId:eM,id:e.id,content:e.content}});if(null==l||null===(n=l.data)||void 0===n||!n.updateThreadMessage)return(null==l?void 0:null===(s=l.error)||void 0===s?void 0:s.message)||"Failed to save";await q(n=>{let s=[...n];return s[t]=e,s})}};(0,l.useEffect)(()=>{ez&&eL(ez)},[ez]);let[{data:eF,fetching:eO}]=(0,T.aM)({query:V.Gx}),[eP,eU]=(0,l.useState)(),[{data:eD,fetching:eZ,error:eG}]=(0,T.aM)({query:V.XL,variables:{ids:[eM]},pause:!eM}),[{data:eQ,error:eV,fetching:eH,stale:e$}]=(0,T.aM)({query:V.r4,variables:{threadId:eM,first:30,after:eP},pause:!eM||K});(0,l.useEffect)(()=>{var e,t,n,s;if(!e$){if(null==eQ?void 0:null===(t=eQ.threadMessages)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length){let e=eQ.threadMessages.edges.map(e=>e.node).slice();q(t=>{var n;return(n=[...t,...e]).length?(0,L.Z)(n,(0,M.Z)("id",2)):[]})}if(null==eQ?void 0:eQ.threadMessages){let e=null==eQ?void 0:null===(s=eQ.threadMessages)||void 0===s?void 0:null===(n=s.pageInfo)||void 0===n?void 0:n.hasNextPage,t=null==eQ?void 0:eQ.threadMessages.pageInfo.endCursor;e&&t?eU(t):B(!0)}}},[eQ]);let eX=(0,l.useMemo)(()=>{var e,t;return!eM||!!w&&null!=eD&&null!==(t=eD.threads)&&void 0!==t&&null!==(e=t.edges)&&void 0!==e&&!!e.length&&w.me.id===eD.threads.edges[0].node.userId},[w,eD,eM]),eq=null==eF?void 0:eF.contextInfo.sources,eJ=null==X?void 0:null===(e=X[0])||void 0===e?void 0:e.content,eW=(0,l.useMemo)(()=>eq&&eJ?(0,h.i8)(eq,eJ,{maxLength:i.$I}):"",[eq,eJ]);(0,l.useEffect)(()=>{eW&&(document.title=eW)},[eW]),(0,l.useEffect)(()=>{eV&&!K&&B(!0)},[eV]);let{sendUserMessage:eK,isLoading:eB,error:eY,answer:e0,stop:e1,regenerate:e4,deleteThreadMessagePair:e2}=(0,Z.x)({threadId:eM}),e5=(0,d.d)(eB),e3=(0,l.useMemo)(()=>X.find(e=>e.id===em),[em,X]),e6=(0,l.useMemo)(()=>e3?(0,R.Z)(null==e3?void 0:e3.attachment,"doc","code"):{answers:X.filter(e=>e.role===F.uU.Assistant).map(e=>(0,R.Z)(e,"doc","code"))},[em,null==e3?void 0:null===(t=e3.attachment)||void 0===t?void 0:t.code,null==e3?void 0:null===(n=e3.attachment)||void 0===n?void 0:n.doc]);(0,l.useEffect)(()=>{y(I),_||A(!0)},[I]),(0,l.useEffect)(()=>{_&&!ez&&(()=>{if(eo.current)return;eo.current=!0;let e=sessionStorage.getItem(i.$6.SEARCH_INITIAL_MSG),t=sessionStorage.getItem(i.$6.SEARCH_INITIAL_CONTEXTS),n=t?JSON.parse(t):void 0;if(e){sessionStorage.removeItem(i.$6.SEARCH_INITIAL_MSG),sessionStorage.removeItem(i.$6.SEARCH_INITIAL_CONTEXTS),B(!0),te(e,n);return}eM||((0,G.wh)(),ei.replace("/"))})()},[_]),(0,l.useEffect)(()=>{K&&setTimeout(()=>{er(!0)},300)},[K]);let{isCopied:e8,onCopy:e7}=function(e){let{threadIdFromURL:t,threadIdFromStreaming:n,streamingDone:s,updateThreadURL:l}=e,{isCopied:r,copyToClipboard:a}=(0,O.m)({timeout:2e3}),i=(0,Q.D)(eS,{onError(e){z.A.error(e.message)}}),o=!t&&s&&n&&l,c=async()=>{if(r)return;let e=window.location.href;o&&(await i({threadId:n}),e=l(n)),a(e)};return{onCopy:c,isCopied:r}}({threadIdFromURL:ez,threadIdFromStreaming:eM,streamingDone:!eB,updateThreadURL:e=>{let t=(0,C.Z)(eW),n=(0,k.Z)([t,e]).join("-"),s=b({pathname:"/search/".concat(n),searchParams:{del:["q"]},replace:!0});return location.origin+s}});(0,l.useEffect)(()=>{var e,t,n,s;e0.threadId&&e0.threadId!==eM&&eL(e0.threadId);let l=[...X],r=l.findIndex(e=>e.id===Y),a=l.findIndex(e=>e.id===et);if(-1===r||-1===a)return;let i=l[r],o=l[a];o.content=e0.content,(null===(e=o.attachment)||void 0===e?void 0:e.code)||!e0.attachmentsCode||(o.attachment={doc:(null===(n=o.attachment)||void 0===n?void 0:n.doc)||null,code:e0.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(t=o.attachment)||void 0===t?void 0:t.doc)||!e0.attachmentsDoc||(o.attachment={doc:e0.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(s=o.attachment)||void 0===s?void 0:s.code)||null}),o.threadRelevantQuestions=null==e0?void 0:e0.relevantQuestions;let c=e0.userMessageId,d=e0.assistantMessageId;c&&d&&c!==i.id&&d!==o.id&&(i.id=c,o.id=d,ee(c),en(d)),q(l)},[eB,e0]),(0,l.useEffect)(()=>{if(eY){let e=[...X],t=e.find(e=>e.id===et);t&&(t.error=eY?"401"===eY.message?"Unauthorized":(0,E.Z)(eY.graphQLErrors,e=>{var t;return(null===(t=e.extensions)||void 0===t?void 0:t.code)===i.ir})?"The thread has expired":eY.message||"Failed to fetch":"Failed to fetch")}},[eY]);let e9=(0,l.useRef)();(0,l.useEffect)(()=>(e5.current&&(e9.current=window.setTimeout(()=>{if(!e5.current)return;W(!0);let e=null==es?void 0:es.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},300)),e5.current||W(!1),()=>{window.clearTimeout(e9.current)}),[eB]),(0,l.useEffect)(()=>{var e,t,n;eu?(null===(e=ef.current)||void 0===e||e.expand(),null===(t=ef.current)||void 0===t||t.resize(eN)):null===(n=ef.current)||void 0===n||n.collapse()},[eu]);let te=(e,t)=>{let n=eb(),s=eb(),l={id:n,role:F.uU.User,content:e},r={id:s,role:F.uU.Assistant,content:""},{sourceIdForCodeQuery:a,sourceIdsForDocQuery:i,searchPublic:o}=eR(t),c=a?{sourceId:a,content:e}:null;ee(n),en(s),q([...X].concat([l,r])),eK({content:e},{generateRelevantQuestions:!0,codeQuery:c,docQuery:{sourceIds:i,content:e,searchPublic:!!o}})},tt=(0,l.useMemo)(()=>{var e,t;if(K&&!eZ&&ez&&(eG||!(null==eD?void 0:null===(t=eD.threads)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length)))return eG||Error(i.ir)},[eD,eZ,eG,K,ez]),[tn]=(0,P.n)(eH||(null==eQ?void 0:null===(g=eQ.threadMessages)||void 0===g?void 0:null===(a=g.pageInfo)||void 0===a?void 0:a.hasNextPage),200);if(K&&(eV||tt))return(0,s.jsx)(ek,{});if(!K&&(tn||e$))return(0,s.jsxs)("div",{children:[(0,s.jsx)(eC,{}),(0,s.jsxs)("div",{className:"mx-auto mt-24 w-full space-y-10 px-4 pb-32 lg:max-w-4xl lg:px-0",children:[(0,s.jsx)(ep,{}),(0,s.jsx)(ep,{})]})]});if(!$||!K)return(0,s.jsx)(s.Fragment,{});let ts=ea?{height:"calc(100vh - ".concat(j.wt,")")}:{height:"100vh"};return(0,s.jsx)(ej.Provider,{value:{isLoading:eB,onRegenerateResponse:()=>{var e;if(!eM||eO)return;let t=X.length-1,n=t-1;if(-1===t||n<=-1)return;let s=X[n].id,l=X[t].id,r=X.slice(0,-2),a=X[n],i={...a,id:eb()},o={id:eb(),role:F.uU.Assistant,content:"",attachment:{code:null,doc:null},error:void 0},c=(0,h.b)(i.content,null==eF?void 0:null===(e=eF.contextInfo)||void 0===e?void 0:e.sources),{sourceIdForCodeQuery:d,sourceIdsForDocQuery:u,searchPublic:m}=eR((0,h.G8)(c)),x=d?{sourceId:d,content:i.content}:null,f={sourceIds:u,content:i.content,searchPublic:m};ee(i.id),en(o.id),q([...r,i,o]),e4({threadId:eM,userMessageId:s,assistantMessageId:l,userMessage:{content:i.content},threadRunOptions:{generateRelevantQuestions:!0,codeQuery:x,docQuery:f}})},onSubmitSearch:te,setDevPanelOpen:eh,setConversationIdForDev:ex,isPathnameInitialized:_,enableDeveloperMode:e_.value,contextInfo:null==eF?void 0:eF.contextInfo,fetchingContextInfo:eO,onDeleteMessage:e=>{if(!eM)return;let t=X.findIndex(t=>t.id===e),n=t-1,s=X[t-1];if(-1!==t&&(null==s?void 0:s.role)===F.uU.User){if(s.id.startsWith(ew)&&e.startsWith(ew)){let e=X.slice(0,n).concat(X.slice(t+1));q(e);return}e2(eM,s.id,e).then(e=>{if(e){z.A.error(e);return}let s=X.slice(0,n).concat(X.slice(t+1));q(s)})}},isThreadOwner:eX,onUpdateMessage:eA},children:(0,s.jsx)("div",{className:"transition-all",style:ts,children:(0,s.jsxs)(f.pO,{direction:"vertical",onLayout:e=>{(null==e?void 0:e[1])&&eI(e[1])},children:[(0,s.jsxs)(f.ee,{children:[(0,s.jsx)(eC,{threadIdFromURL:ez,streamingDone:e0.completed}),(0,s.jsxs)("main",{className:"h-[calc(100%-4rem)] pb-8 lg:pb-0",children:[(0,s.jsx)(v.ScrollArea,{className:"h-full",ref:es,children:(0,s.jsx)("div",{className:"mx-auto px-4 pb-32 lg:max-w-4xl lg:px-0",children:(0,s.jsx)("div",{className:"flex flex-col",children:X.map((e,t)=>{let n=t===X.length-1;return e.role===F.uU.User?(0,s.jsx)(eg,{className:"pb-2 pt-8",message:e},e.id):e.role===F.uU.Assistant?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ed,{className:"pb-8 pt-2",message:e,isLastAssistantMessage:n,showRelatedQuestion:n,isDeletable:!eB&&X.length>2},e.id),!n&&(0,s.jsx)(H.Z,{})]}):null})})})}),(0,s.jsx)(p.K,{className:(0,h.cn)("!fixed !bottom-[5.4rem] !right-4 !top-auto z-40 border-muted-foreground lg:!bottom-[2.85rem]",{hidden:eu}),container:es.current,offset:100,style:"dark"===ec?{"--background":"0 0% 12%"}:{}}),(0,s.jsxs)("div",{className:(0,h.cn)("fixed bottom-5 left-0 z-30 flex min-h-[3rem] w-full flex-col items-center gap-y-2",{"opacity-100 translate-y-0":el,"opacity-0 translate-y-10":!el,hidden:eu}),style:Object.assign({transition:"all 0.35s ease-out"},"dark"===ec?{"--background":"0 0% 12%"}:{}),children:[(0,s.jsxs)("div",{className:(0,h.cn)("absolute flex items-center gap-4 ",{"-top-10":eX}),children:[J&&(0,s.jsxs)(m.z,{className:"bg-background",variant:"outline",onClick:()=>e1(),children:[(0,s.jsx)(x.IconStop,{className:"mr-2"}),"Stop generating"]}),!J&&(0,s.jsxs)(m.z,{className:"bg-background",variant:"outline",onClick:e7,children:[e8?(0,s.jsx)(x.IconCheck,{className:"mr-2 text-green-600"}):(0,s.jsx)(x.IconShare,{className:"mr-2"}),"Share Link"]})]}),eX&&(0,s.jsx)("div",{className:(0,h.cn)("relative z-20 flex justify-center self-stretch px-4"),children:(0,s.jsx)(N.Z,{onSearch:te,className:"min-h-[5rem] lg:max-w-4xl",placeholder:"Ask a follow up question",isLoading:eB,isFollowup:!0,contextInfo:null==eF?void 0:eF.contextInfo,fetchingContextInfo:eO})})]})]})]}),(0,s.jsx)(f.Dp,{className:(0,h.cn)("hidden !h-[4px] border-none bg-background shadow-[0px_-4px_4px_rgba(0,0,0,0.2)] hover:bg-blue-500 active:bg-blue-500 dark:shadow-[0px_-4px_4px_rgba(255,255,255,0.2)]",eu&&"block")}),(0,s.jsx)(f.ee,{collapsible:!0,collapsedSize:0,defaultSize:0,ref:ef,onCollapse:()=>eh(!1),className:"z-50",children:(0,s.jsx)(ev,{onClose:()=>eh(!1),value:e6,isFullScreen:100===eN,onToggleFullScreen:e=>{var t;let n=eE.current;e?n=100:100===n&&(n=45),null===(t=ef.current)||void 0===t||t.resize(n),eI(n),eE.current=eN}})})]})})})}let eS=(0,A.BX)("\n  mutation SetThreadPersisted($threadId: ID!) {\n    setThreadPersisted(threadId: $threadId)\n  }\n"),ey=(0,A.BX)("\n  mutation UpdateThreadMessage($input: UpdateMessageInput!) {\n    updateThreadMessage(input: $input)\n  }\n");function eC(e){let{threadIdFromURL:t,streamingDone:n}=e,l=(0,r.useRouter)(),a=e=>{e&&(0,G.wh)(),l.push("/")};return(0,s.jsxs)("header",{className:"flex h-16 items-center justify-between px-4 lg:px-10",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-6",children:(0,s.jsxs)(m.z,{variant:"ghost",className:"-ml-1 pl-0 text-sm text-muted-foreground",onClick:()=>a(),children:[(0,s.jsx)(x.IconChevronLeft,{className:"mr-1 h-5 w-5"}),"Home"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(n||t)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(m.z,{variant:"ghost",className:"flex items-center gap-1 px-2 font-normal text-muted-foreground",onClick:()=>a(!0),children:(0,s.jsx)(x.IconPlus,{})})}),(0,s.jsx)(g.q,{children:(0,s.jsx)(w.T,{className:"mr-4"})}),(0,s.jsx)(I.Z,{showHome:!1,showSetting:!0,beforeRouteChange:()=>{(0,G.wh)()},children:(0,s.jsx)(b.SQ,{className:"h-10 w-10 border"})})]})]})}function ek(){return(0,s.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,s.jsx)(eC,{}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.IconFileSearch,{className:"h-6 w-6"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:"Something went wrong"})]}),(0,s.jsx)("div",{children:"Failed to fetch the thread, please refresh the page or start a new thread"}),(0,s.jsxs)(y(),{href:"/",onClick:G.wh,className:(0,h.cn)((0,m.d)(),"mt-4 gap-2"),children:[(0,s.jsx)(x.IconPlus,{}),(0,s.jsx)("span",{children:"New Thread"})]})]})})]})}function eR(e){let t,n=[],s=!1;if(e){var l,r,a,i;n=(0,_.Z)((0,k.Z)([null==e?void 0:null===(l=e.codeSourceIds)||void 0===l?void 0:l[0]].concat(e.docSourceIds))),s=null!==(a=e.searchPublic)&&void 0!==a&&a,t=null!==(i=null===(r=e.codeSourceIds)||void 0===r?void 0:r[0])&&void 0!==i?i:void 0}return{sourceIdsForDocQuery:n,sourceIdForCodeQuery:t,searchPublic:s}}},98150:function(e,t,n){"use strict";n.d(t,{NI:function(){return v},Wi:function(){return u},l0:function(){return c},lX:function(){return f},pf:function(){return p},xJ:function(){return x},zG:function(){return g}});var s=n(36164),l=n(3546),r=n(74047),a=n(5493),i=n(1544),o=n(5266);let c=a.RV,d=l.createContext({}),u=e=>{let{...t}=e;return(0,s.jsx)(d.Provider,{value:{name:t.name},children:(0,s.jsx)(a.Qr,{...t})})},h=()=>{let e=l.useContext(d),t=l.useContext(m),{getFieldState:n,formState:s}=(0,a.Gc)(),r=e.name||"root",i=n(r,s);if(!s)throw Error("useFormField should be used within <Form>");let{id:o}=t;return{id:o,name:r,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...i}},m=l.createContext({}),x=l.forwardRef((e,t)=>{let{className:n,...r}=e,a=l.useId();return(0,s.jsx)(m.Provider,{value:{id:a},children:(0,s.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",n),...r})})});x.displayName="FormItem";let f=l.forwardRef((e,t)=>{let{className:n,required:l,...r}=e,{error:a,formItemId:c}=h();return(0,s.jsx)(o._,{ref:t,className:(0,i.cn)(a&&"text-destructive",l&&'after:ml-0.5 after:text-destructive after:content-["*"]',n),htmlFor:c,...r})});f.displayName="FormLabel";let v=l.forwardRef((e,t)=>{let{...n}=e,{error:l,formItemId:a,formDescriptionId:i,formMessageId:o}=h();return(0,s.jsx)(r.g7,{ref:t,id:a,"aria-describedby":l?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!l,...n})});v.displayName="FormControl";let p=l.forwardRef((e,t)=>{let{className:n,...l}=e,{formDescriptionId:r}=h();return(0,s.jsx)("div",{ref:t,id:r,className:(0,i.cn)("text-sm text-muted-foreground",n),...l})});p.displayName="FormDescription";let g=l.forwardRef((e,t)=>{let{className:n,children:l,...r}=e,{error:a,formMessageId:o}=h(),c=a?String(null==a?void 0:a.message):l;return c?(0,s.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",n),...r,children:c}):null});g.displayName="FormMessage"},53538:function(e,t,n){"use strict";n.d(t,{Dp:function(){return o},ee:function(){return i},pO:function(){return a}});var s=n(36164),l=n(6618),r=n(1544);let a=e=>{let{className:t,...n}=e;return(0,s.jsx)(l.eh,{className:(0,r.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...n})},i=l.s_,o=e=>{let{withHandle:t,className:n,...a}=e;return(0,s.jsx)(l.OT,{className:(0,r.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",n),...a,children:t&&(0,s.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})}},93877:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});var s=n(3546);let l=(e,t)=>{let[n,l]=(0,s.useState)(t),[r,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let t=localStorage.getItem(e);t&&l(JSON.parse(t)),a(!1)},[]),[n,t=>{l(t),localStorage.setItem(e,JSON.stringify(t))},r]};class r{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,t,n,s){this.storageKey=e,this.title=t,this.description=n,this.defaultValue=s}}let a=new class{defineGlobalVar(){return new r(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,t,n]=l(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:n},()=>{t(!e)}]}}constructor(e,t,n,s){this.storageKey="EXP_".concat(e),this.title=t,this.description=n,this.defaultValue=null!=s&&s}}("enable_developer_mode","Developer Mode","Enable the developer mode. The features involved include the Answer Engine.",!1);a.defineGlobalVar();let i=a.defineHook()},44645:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var s=n(3546),l=n(11978);function r(){let e=(0,l.usePathname)(),t=(0,l.useRouter)(),n=(0,l.useSearchParams)(),r=(0,s.useCallback)(e=>{let t=new URLSearchParams(n);e&&Object.entries(e).forEach(e=>{let[n,s]=e;return t.set(n,s)});let s=t.toString();return s.length>0?"?".concat(s):""},[n]),a=(0,s.useCallback)(s=>{let l=function(e,t,n){var s,l;let r=null===(s=n.searchParams)||void 0===s?void 0:s.set,a=null===(l=n.searchParams)||void 0===l?void 0:l.del,i=new URLSearchParams(t);r&&Object.entries(r).forEach(e=>{let[t,n]=e;return i.set(t,n)}),a&&(Array.isArray(a)?a.forEach(e=>i.delete(e)):i.delete(a));let o=i.toString(),c=e;return o.length>0&&(c+="?".concat(o)),n.hash&&(c+="#".concat(n.hash.replace(/^#/,""))),c}((null==s?void 0:s.pathname)||e,n,s);return s.replace?t.replace(l):t.push(l),l},[e,n]);return{pathname:e,router:t,searchParams:n,getQueryString:r,updateUrlComponents:a}}},2489:function(){},82030:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var s=n(94219),l=n(79204),r=(0,n(43285).Z)(function(e,t){return null==e?{}:(0,s.Z)(e,t,function(t,n){return(0,l.Z)(e,n)})})}},function(e){e.O(0,[8415,3078,753,1386,55,1058,4007,6377,3643,2578,6345,9421,240,4421,1454,1722,4546,9275,4553,9148,4405,1266,596,446,1112,6898,7045,1544,1565,3821,1068,8223,3375,5289,1744],function(){return e(e.s=72845)}),_N_E=e.O()}]);